/*
 * 	desMam - jQuery plugin
 *
 *	Built for jQuery library
 *	http://jquery.com
 *
 *  Creado: 30-07-2012
 *  Modificado: 03-06-2014 -> agrego Hockey
 *
 */
(function(a){a.fn.desMam=function(f){var j=jQuery.extend({deporte:"futbol",mam:"",xmlFechaServer:"/mam/fechaserver.xml"},f);var i=this;var k,l,m;var d=i.find(".dmmIncidencias").text();var g=0;var b=0;function c(){var e;a.ajax({url:j.xmlFechaServer,async:false,cache:false,success:function(q){var s=a(q).find("dia").text();var o=a(q).find("hora").text();var t=s.substring(0,4);var r=s.substring(4,6);var n=s.substring(6,8);var p=o.split(":");e=new Date(t,r,n,p[0],p[1],p[2],0);return e.getTime()}});return e}function h(){a.ajax({url:j.mam,cache:false,success:function(u){if(j.deporte=="futbol"||j.deporte=="hockey"||j.deporte=="tenis"||j.deporte=="rugby"){var x=a(u).find('equipo[condicion="local"]').attr("goles");var r=a(u).find('equipo[condicion="visitante"]').attr("goles");var e=a(u).find('equipo[condicion="local"]').attr("golesDefPenales");var y=a(u).find('equipo[condicion="visitante"]').attr("golesDefPenales");if(x!=""&&r!=""&&typeof x!="undefined"&&typeof r!="undefined"){if(e!=""||y!=""){i.find(".dmmGolesLoc").html(x+"<em>("+e+")</em>");i.find(".dmmGolesVis").html(r+"<em>("+y+")</em>")}else{i.find(".dmmGolesLoc").html(x);i.find(".dmmGolesVis").html(r)}}var s=a(u).find("fichapartido").attr("dia");var q=a(u).find("horaEstadoEvento").text();var p=a(u).find("estadoEvento").text();if(p.toLowerCase()!="finalizado"){if(q!=""&&p!=""){if(j.deporte=="futbol"){if(k!=p){k=p;var B=c();var z=s.substring(0,4);var t=s.substring(4,6);var v=s.substring(6,8);var o=q.split(":");var n=new Date(z,t,v,o[0],o[1],o[2],0);if(B<n.getTime()){m=0}else{m=Math.floor((B-n)/60000)}}else{m++}switch(p.toLowerCase()){case"primer tiempo":p=m+" min PT";break;case"segundo tiempo":p=m+" min ST";break;case"entretiempo":p="Descanso";break;case"alargue 1":p=m+" min PTS";break;case"alargue 2":p=m+" min STS";break;case"fin alargue 1":p="Fin PTS";break;case"fin alargue 2":p="Fin STS";break;case"definición por penales":p="Penales";break}}else{switch(p.toLowerCase()){case"primer tiempo":p="PT";break;case"segundo tiempo":p="ST";break;case"entretiempo":p="Descanso";break;case"alargue 1":p="PTS";break;case"alargue 2":p="STS";break;case"fin alargue 1":p="Fin PTS";break;case"fin alargue 2":p="Fin STS";break;case"definición por penales":p="Penales";break}}i.find(".dmmTiempo").html(p);setTimeout(function(){h()},60000)}}else{i.find(".dmmTiempo").html(p)}var w="";if(a.trim(d)!=""){w='<div class="dmmIncidencia">'+d+"</div>"}var A=a(u).find('incidencias incidencia[tipo="gol"]').length-1;a(u).find('incidencias incidencia[tipo="gol"]').each(function(H){var F=a(this);var C="";var G="";var K=F.find("tiempo").text()+" ";var D=F.find("minuto").text()+"m ";var E=F.find("jugador").text()+" ";var J="("+F.find("equiponomcorto").text()+")";if(H==0){if(w!=""){C=", "}}else{C=", ";if(A==H){var G="&nbsp;&nbsp;//&nbsp;&nbsp;"}}var I='<div class="dmmIncidencia">'+C+K+D+E+J+G+"</div>";w+=I});i.removeClass("alertaGol");if(b==0){g=A;b=1}if(g!=A){g=A;i.addClass("alertaGol")}if(l!=w){l=w;i.find(".dmmIncidencias").html(w);i.find(".dmmMarquee").desMarquee()}}if(j.deporte=="tenis"){i.find(".dmmLoc .dmmSaque, .dmmVis .dmmSaque").hide();a(u).find("equipo").each(function(){var F=a(this);var E=F.attr("condicion");var D=E.substr(0,1).toUpperCase()+E.substr(1,2).toLowerCase();var C="";F.find("incidencias").each(function(){a(this).find('incidencia[tipo^="Puntos"]').each(function(){if(a(this).attr("tipo").indexOf("tie")<0){C+="<li>"+a(this).find("descripcion").text()+"</li>"}})});i.find(".dmmGoles"+D+" .dmmSets").html(C);if(F.attr("saque")=="S"){i.find(".dmm"+D+" .dmmSaque").css("display","inline")}else{i.find(".dmm"+D+" .dmmSaque").hide()}});i.find(".dmmMarquee").desMarquee();var p=a(u).find("estadoEvento").text();if(p.toLowerCase()!="finalizado"){if(q!=""&&p!=""){if(k!=p){k=p}i.find(".dmmTiempo").html(p);setTimeout(function(){h()},60000)}}else{i.find(".dmmTiempo").html(p)}}}})}if(j.mam){h()}else{i.html("El ID de partido es incorrecto.")}}}(jQuery));
